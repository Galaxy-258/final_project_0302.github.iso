<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>订单确认 - 小兔鲜儿</title>
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/order.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- 快捷导航 -->
    <div class="shortcut">
        <div class="wrapper">
            <ul>
                <li><a href="login.html" class="login-link">请先登录</a></li>
                <li><a href="register.html" class="register-link">免费注册</a></li>
                <li><a href="user-center.html">个人中心</a></li>
                <li><a href="order.html" class="current-page">我的订单</a></li>
                <li><a href="#">帮助中心</a></li>
                <li><a href="#">在线客服</a></li>
                <li><a href="#"><img src="./uploads/手机.png" class="phone-icon"> 手机版</a></li>
            </ul>
        </div>
    </div>

    <!-- 头部 -->
    <div class="header wrapper">
        <!-- logo区域 -->
        <div class="logo">
            <h1><a href="index.html">小兔鲜儿</a></h1>
        </div>
        <!-- 导航区域 nav -->
        <div class="nav">
            <ul>
                <li><a href="index.html">首页</a></li>
                <li><a href="#">生鲜</a></li>
                <li><a href="#">美食</a></li>
                <li><a href="#">餐厨</a></li>
                <li><a href="#">电器</a></li>
                <li><a href="#">家居</a></li>
                <li><a href="#">洗护</a></li>
                <li><a href="#">孕婴</a></li>
                <li><a href="#">服装</a></li>
            </ul>
        </div>
        <!-- 搜索区域 search -->
        <div class="search">
            <input type="text" placeholder="搜一搜">
        </div>
        <!-- 购物车 cart -->
        <div class="cart">
            <a href="cart.html">
                <img src="./uploads/购物 车1.png" alt="购物车" class="cart-icon">
                <i class="cart-badge">0</i>
            </a>
        </div>
    </div>

    <!-- 订单确认主要内容 -->
    <div class="order-container wrapper">
        <div class="order-success">
            <i class="fas fa-check-circle success-icon"></i>
            <h2>订单提交成功！</h2>
            <div class="order-info">
                <p>订单号：<span id="orderNumber">ORD<span id="orderId"></span></span></p>
                <p>下单时间：<span id="orderTime"></span></p>
                <p>应付金额：<span class="order-total" id="orderTotal">¥0.00</span></p>
                <p>收货地址：<span id="orderAddress">北京市朝阳区建国路88号SOHO现代城C座1808室</span></p>
                <p>配送方式：<span id="orderShipping">普通快递</span></p>
                <p>支付方式：<span id="orderPayment">支付宝支付</span></p>
            </div>
            
            <div class="order-actions">
                <a href="index.html" class="btn-continue-shopping">
                    <i class="fas fa-shopping-cart"></i> 继续购物
                </a>
                <a href="#" class="btn-view-orders" onclick="viewOrders()">
                    <i class="fas fa-list"></i> 查看我的订单
                </a>
                <a href="#" class="btn-pay-now" onclick="payNow()">
                    <i class="fas fa-credit-card"></i> 立即支付
                </a>
            </div>
            
            <div class="order-tips">
                <p><i class="fas fa-info-circle"></i> 温馨提示：订单已生成，请在24小时内完成支付</p>
            </div>
        </div>
        
        <div class="order-details">
            <h3><i class="fas fa-box-open"></i> 订单详情</h3>
            <div class="order-items" id="orderItems">
                <!-- 订单商品会通过JS动态加载 -->
            </div>
            
            <div class="order-summary">
                <h4>订单摘要</h4>
                <div class="summary-row">
                    <span>商品金额：</span>
                    <span id="orderSubtotal">¥0.00</span>
                </div>
                <div class="summary-row">
                    <span>运费：</span>
                    <span id="orderShippingFee">¥15.00</span>
                </div>
                <div class="summary-row discount">
                    <span>优惠折扣：</span>
                    <span id="orderDiscount">-¥0.00</span>
                </div>
                <div class="summary-row total">
                    <span>应付总额：</span>
                    <span id="orderFinalTotal">¥0.00</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部 -->
    <div class="footer">
        <div class="service wrapper">
            <ul>
                <li><a href="#"><h5>价格亲民</h5></a></li>
                <li><a href="#"><h5>物流快捷</h5></a></li>
                <li><a href="#"><h5>品质新鲜</h5></a></li>
                <li><a href="#"><h5>售后无忧</h5></a></li>
            </ul>
        </div>
        <!-- 帮助中心 help -->
        <div class="help wrapper">
            <dl>
                <dt>购物指南</dt>
                <dd><a href="#">购物流程</a></dd>
                <dd><a href="#">支付方式</a></dd>
                <dd><a href="#">售后规则</a></dd>
            </dl>
            <dl>
                <dt>配送方式</dt>
                <dd><a href="#">配送运费</a></dd>
                <dd><a href="#">配送范围</a></dd>
                <dd><a href="#">配送时间</a></dd>
            </dl>
            <dl>
                <dt>关于我们</dt>
                <dd><a href="#">平台规则</a></dd>
                <dd><a href="#">联系我们</a></dd>
                <dd><a href="#">问题反馈</a></dd>
            </dl>
            <dl>
                <dt>售后服务</dt>
                <dd><a href="#">售后政策</a></dd>
                <dd><a href="#">退款说明</a></dd>
                <dd><a href="#">取消订单</a></dd>
            </dl>
            <dl>
                <dt>服务热线</dt>
                <dd><a href="#">在线客服 <img src="./uploads/客服.png" class="service-icon" alt="客服"></a></dd>
                <dd><a href="#">客服电话 400-0000-000</a></dd>
                <dd><a href="#">工作时间 周一至周日 8:00-18:00</a></dd>
            </dl>
            <div class="right">
                <ul>
                    <li>
                        <img src="./images/wechat.png" alt="">
                        <p>微信公众号</p>
                    </li>
                    <li>
                        <img src="./images/app.png" alt="">
                        <p>APP下载二维码</p>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 版权 copyright -->
        <div class="copyright wrapper">
            <p>
                <a href="#">关于我们</a> &nbsp|&nbsp
                <a href="#">帮助中心</a> &nbsp|&nbsp
                <a href="#">售后服务</a> &nbsp|&nbsp
                <a href="#">配送与验收</a> &nbsp|&nbsp
                <a href="#">商务合作</a> &nbsp|&nbsp
                <a href="#">搜索推荐</a> &nbsp|&nbsp
            </p>
            <p><a href="#">@CopyRight © 小兔鲜儿</a></p>
            <p>学号：25216950302 | 姓名：李妍茵 | 实验课程：Web编程技术 | 实验项目：小兔鲜儿官网期末综合项目</p>
        </div>
    </div>
    <script>
        // 直接操作DOM
        (function() {
            console.log('=== 开始处理用户状态 ===');
            
            // 1. 检查用户登录状态
            const userStr = localStorage.getItem('currentUser');
            console.log('localStorage中的用户数据:', userStr);
            
            let user = null;
            if (userStr) {
                try {
                    user = JSON.parse(userStr);
                    console.log('解析后的用户对象:', user);
                } catch (e) {
                    console.error('解析用户数据失败:', e);
                }
            }
            
            // 2. 找到所有的li元素
            const allLis = document.querySelectorAll('.shortcut ul li');
            console.log('总共找到的li元素数量:', allLis.length);
            
            // 3. 遍历找到登录和注册链接
            let loginLi = null;
            let loginLink = null;
            let registerLi = null;
            
            for (let i = 0; i < allLis.length; i++) {
                const li = allLis[i];
                const link = li.querySelector('a');
                
                if (!link) continue;
                
                const href = link.getAttribute('href');
                console.log(`第${i+1}个li的链接: ${href}`);
                
                if (href === 'login.html') {
                    loginLi = li;
                    loginLink = link;
                    console.log('找到登录链接:', link);
                } else if (href === 'register.html') {
                    registerLi = li;
                    console.log('找到注册链接:', link);
                }
            }
            
            // 4. 如果用户已登录，更新界面
            if (user && user.isLoggedIn) {
                console.log('用户已登录，用户名:', user.username);
                
                // 更新登录链接
                if (loginLink) {
                    loginLink.textContent = `欢迎，${user.username}`;
                    loginLink.href = 'javascript:void(0);';
                    loginLink.style.color = '#5EB69C';
                    
                    // 关键修改：增加登录链接的右边距，让文字和分隔符有更多空间
                    loginLi.style.padding = '0 20px 0 15px'; // 右边距从15px增加到20px
                    loginLi.style.borderRight = '0.5px solid #999';
                }
                
                // 隐藏注册链接
                if (registerLi) {
                    console.log('隐藏注册链接');
                    registerLi.remove();
                }
                
                // 5. 重新设置所有li的边框和间距
                setTimeout(() => {
                    const currentLis = document.querySelectorAll('.shortcut ul li');
                    console.log('重新设置边框，当前li数量:', currentLis.length);
                    
                    // 设置统一的间距
                    currentLis.forEach((li, index) => {
                        // 如果是登录链接，保持增加的右边距
                        if (index === 0 && loginLi) {
                            li.style.padding = '0 20px 0 15px'; // 登录链接右边距20px
                        } else {
                            li.style.padding = '0 15px'; // 其他链接保持15px
                        }
                        
                        // 设置边框
                        if (index < currentLis.length - 1) {
                            li.style.borderRight = '0.5px solid #999';
                        } else {
                            li.style.borderRight = 'none'; // 最后一个没有边框
                        }
                    });
                    
                    console.log('边框和间距设置完成');
                }, 50);
                
                // 6. 添加下拉菜单
                if (loginLink) {
                    loginLink.addEventListener('mouseenter', function(e) {
                        // 创建菜单
                        const menu = document.createElement('div');
                        menu.className = 'user-dropdown-menu';
                        menu.innerHTML = `
                            <div class="menu-header">
                                <div class="user-info-small">
                                    <div class="username">${user.username}</div>
                                    <div class="user-email">${user.email || '未设置邮箱'}</div>
                                </div>
                            </div>
                            <div class="menu-divider"></div>
                            <a href="user-center.html" class="menu-item"> 
                                <span class="menu-icon">👤</span> 个人中心
                            </a>
                            <a href="cart.html" class="menu-item">
                                <span class="menu-icon">🛒</span> 我的购物车
                            </a>
                            <a href="order.html" class="menu-item">
                                <span class="menu-icon">📦</span> 我的订单
                            </a>
                            <a href="index.html" class="menu-item">
                                <span class="menu-icon">🏠</span> 返回首页
                            </a>
                            <div class="menu-divider"></div>
                            <a href="#" class="menu-item logout" onclick="logout()">
                                <span class="menu-icon">🚪</span> 退出登录
                            </a>
                        `;
                        
                        // 定位菜单
                        const rect = this.getBoundingClientRect();
                        menu.style.position = 'fixed';
                        menu.style.top = (rect.bottom + 5) + 'px';
                        menu.style.right = (window.innerWidth - rect.right + 20) + 'px';
                        menu.style.zIndex = '10000';
                        menu.style.background = 'white';
                        menu.style.borderRadius = '8px';
                        menu.style.boxShadow = '0 4px 20px rgba(0,0,0,0.15)';
                        menu.style.minWidth = '180px';
                        menu.style.overflow = 'hidden';
                        
                        document.body.appendChild(menu);
                        
                        // 鼠标离开时移除菜单
                        let timeout;
                        menu.addEventListener('mouseleave', () => {
                            timeout = setTimeout(() => {
                                if (menu && menu.parentNode) {
                                    menu.parentNode.removeChild(menu);
                                }
                            }, 300);
                        });
                        
                        menu.addEventListener('mouseenter', () => {
                            if (timeout) clearTimeout(timeout);
                        });
                        
                        this.addEventListener('mouseleave', () => {
                            timeout = setTimeout(() => {
                                if (menu && menu.parentNode) {
                                    menu.parentNode.removeChild(menu);
                                }
                            }, 300);
                        });
                    });
                }
            } else {
                console.log('用户未登录');
                
                // 用户未登录，恢复原始状态
                if (loginLi) {
                    loginLi.style.padding = '0 15px'; // 恢复默认间距
                }
            }
            
            console.log('=== 用户状态处理完成 ===');
            
            // 退出登录函数
            window.logout = function() {
                if (confirm('确定要退出登录吗？')) {
                    localStorage.removeItem('currentUser');
                    window.location.reload();
                }
            };
        })();
        </script>
    <script src="./js/auth.js"></script>
    <script src="./js/order.js"></script>
</body>
</html>